<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2025 · 年度记录</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>

  <!-- <header>
    <h1>2025</h1>
    <p>这一年的关键词：沉淀、探索、生长</p>
  </header> -->
  <header style="display: flex; align-items: center; gap: 20px;">
    <div id="music-trigger" class="snake-icon">
      🐍 </div>
  
    <div>
      <h1>2025</h1>
      <p>2025是农历蛇年，从今年开始给blog换了个新皮肤(gemini半小时搞定的)。MKE冬天太长了，很长时间都会呆家里，为了push练琴，以后将年度的歌曲都会换成自己练的谱子。</p>
    </div>
    
    <audio id="bgm" src="assets/summerwar.mp3" loop></audio>
  </header>
  
  <main>
    <section>
      <h2>Sakae in Action</h2>
      <p>
        2025年家庭成员 + 1，年初领养了Lilly，虽然住的房子不大，但是还是给它腾出了空间。第一次不在家过年，但还是看完了春晚。
        球赛 + 12（两场国青，两场世预赛，还有八场小将），电视剧 + 5（唯一还有印象的是刚刷完的老舅，一个超现实主义题材的），纪录片 + 4 （徒步， 饮食， 地理），
        电影 + 2 （和LX还有CQ在brookfield影院看的两部春节档，哪吒还有唐探， 北美应该只有这两部剧上映了），音乐会 +1（也是和LX在Miller theatre 看的，Naruto系列）， 书 +2 （sand bed secrets，王维十五日谈）。
      </p>
      <section class="image-gallery-grid">
          <figure class="image rotate-90"><img src="assets/images/2025/lilly.webp"></figure>
          <figure class="image rotate-90"><img src="assets/images/2025/lillydraw.webp"></figure>
          <figure class="image"><img src="assets/images/2025/book.png"></figure>
          <!-- <figure class="image"><img src="assets/images/2025/fountainview3.webp"><figcaption>fountainview3</figcaption></figure>
          <figure class="image"><img src="assets/images/2025/fountainview4.webp"><figcaption>fountainview4</figcaption></figure>
          <figure class="image"><img src="assets/images/2025/fountainview5.webp"><figcaption>fountainview5</figcaption></figure>
          <figure class="image"><img src="assets/images/2025/fountainview6.webp"><figcaption>fountainview6</figcaption></figure>
          <figure class="image"><img src="assets/images/2025/fountainview7.webp"><figcaption>fountainview7</figcaption></figure>
          <figure class="image"><img src="assets/images/2025/fountainview8.webp"><figcaption>fountainview8</figcaption></figure> -->
      </section>
      <p>
        MKE的冬天很长，三月底还在下雪，第一个学期修了710 和711两门课，711之前学过了，所以这学期课程不是很重，大部分时间在搭testbed。
        本来准备在签证过期前回一次国，但是种种政策原因没能回去。五月中去Monterey参加了高中同学YH的毕业典礼，在斯坦福校园逛了很久，正好赶上engineering建系100周年，Robotics Center开放了很多lab可以参观。
      </p>
      <section class="image-gallery-grid">
          <figure class="image"><img src="assets/images/2025/Stanford2.webp"></figure>
          <figure class="image"><img src="assets/images/2025/Stanford3.webp"></figure>
          <figure class="image"><img src="assets/images/2025/stanford4.webp"></figure>
      </section>
      <p>
        月底搬到了一个离学校更近的公寓,好处就是早上可以晚起一会，晚上可以很晚回家。不做实验的时候基本在lab看不到我，公寓旁边的atwater还有stone creek是两个常去的根据地。stone creek是最近的一个咖啡厅，已经和店里的每个人都很熟悉了。
        atwater是在密歇根湖的西边，所以没机会看到日落，但是可以一览夏秋的湖景和云，所以也是一可以写东西的好地方。整个summer没怎么活动，偶尔想起来还会去原来家附近的球场踢一小会。
      </p>
      <section class="image-gallery-grid">
          <figure class="image"><img src="assets/images/2025/fountainview7.webp"></figure>
          <figure class="image"><img src="assets/images/2025/fountainview6.webp"></figure>
          <figure class="image"><img src="assets/images/2025/fountainview4.webp"></figure>
          <figure class="image"><img src="assets/images/2025/fountainview5.webp"></figure>
          <figure class="image"><img src="assets/images/2025/fountainview3.webp"></figure>
          <figure class="image"><img src="assets/images/2025/fountainview2.webp"></figure>
          <figure class="image"><img src="assets/images/2025/fountainview8.webp"></figure>
          <figure class="image"><img src="assets/images/2025/whitefishbay.webp"></figure>
          <figure class="image"><img src="assets/images/2025/whitefishbay4.webp"></figure>
          <figure class="image"><img src="assets/images/2025/whitefishbay3.webp"></figure>
          <figure class="image"><img src="assets/images/2025/whitefishbay2.webp"></figure>
          <figure class="image"><img src="assets/images/2025/whitefishbay5.webp"></figure>
      </section>
      <p>  
        老板支持我每学期要出去参加一个会议，但是这学期并没有啥产出，所以投了一个poster，去长岛听了一个metric的会。很多人都是做scheduling的，听不太明白，但是stony brook校园还是挺有特色的，有很多中国元素。
        从纽约回来以后，就开始写这篇文章了，大部分实验需要重做，因为我们都放在了端侧，很多任务也都重新进行了设计。暑假和老板也一直沟通进度，还有另一个老师，已经不记得线上meeting了多少次。
        八月中投出去了，一个暑假也结束了，这算是上半年最耗费精力的一个工程，现在看来，有很多经验和教训。很关键的就是效率，这个东西要么得脑子清楚，理论扎实，像运动员上场前一样，先把模型实验现在脑子里演示个几遍，碰到各种情况都能游刃有余后再出手；
        要么就得手脚勤快点，执行力max，算是从实践中学。为了模仿成为前者，一直奋斗多年，但是快速验证idea的执行力对我应该帮助更大。
      </p>  
      <section class="image-gallery-grid">
          <figure class="image"><img src="assets/images/2025/stonybrook.webp"></figure>
          <figure class="image rotate-90"><img src="assets/images/2025/sb1.webp"></figure>
      </section>
      <p>
        第二个学期开始在ray cluster上做了一个edge defense的实验，效果不错，所以拿去投了一个workshop。也花了不少时间在351上，和boyland工作的一学期收益很多。这学期还选了老板的一门课，是关于怎么读文章的，知识类的课程对我帮助不大，但是这门课对我讲收获很多。
        我读文章速度很慢，每周两篇是消化不过来的，开始读会有一种心态就是每个工作都要搞懂，但是后来逐渐感觉搞明白一个系列的工作就很难得。学期开始投的会在DC，这也是全程比较完整参加的一个会，体验也是最好的。虽然没时间去到处逛逛，但是正好赶上了世界杯抽签，一
        出机场就看到了FIFA的牌子，也是在抽签这天，正好收到了R2 reject，虽然rebuttal后有这种预感，但是第一个花费很多心血的工作收到结果还是很down，老板第一时间打电话讲没必要frustrated。好吧，菜就多练，我接着去改了。
      </p>
      
      <section class="image-gallery-grid">
          <figure class="image"><img src="assets/images/2025/worldcup.webp"></figure>
          <figure class="image"><img src="assets/images/2025/worldcuph.webp"></figure>
      </section>

    </section>

    <!-- <section>
      <h2>影像记忆</h2>
      <img src="assets/media/image.jpg" alt="年度照片">
    </section> -->

    <section id="comments">
      <h2>新年快乐</h2>
      <form id="comment-form">
        <input id="name" placeholder="你的昵称" required />
        <textarea id="content" placeholder="写下你的想法..." rows="4" required></textarea>
        <button type="submit">发布留言</button>
      </form>

      <div id="comment-list">
        </div>
    </section>
  </main>

  <script>
    const PAGE = "2025";
    const commentList = document.getElementById("comment-list");
    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#A29BFE'];
    const bgm = document.getElementById('bgm');
    const musicTrigger = document.getElementById('music-trigger');

    function formatTime(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const diff = (now - date) / 1000;
    
      if (diff < 60) return '刚刚';
      if (diff < 3600) return Math.floor(diff / 60) + '分钟前';
      if (diff < 86400) return Math.floor(diff / 3600) + '小时前';
      
      return date.toLocaleString('zh-CN', { 
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // 统一的状态管理函数
    function playMusic() {
        bgm.play().then(() => {
            musicTrigger.classList.add('playing');
        }).catch(err => {
            console.log("播放被拦截:", err);
        });
    }
    
    function pauseMusic() {
        bgm.pause();
        musicTrigger.classList.remove('playing');
    }
    
    // 1. 蛇图标的点击：手动切换开关
    musicTrigger.addEventListener('click', (e) => {
        e.stopPropagation(); // 防止触发下面的全局点击事件
        if (bgm.paused) {
            playMusic();
        } else {
            pauseMusic();
        }
    });
    
    // 2. 全局点击：只要还没播，点哪里都尝试触发
    document.addEventListener('click', () => {
        if (bgm.paused) {
            playMusic();
        }
    }, { once: true }); // { once: true } 保证这个全局监听器只在第一次点击时生效
    
    // 3. 针对移动端（如微信、Safari）的触摸触发
    document.addEventListener('touchstart', () => {
        if (bgm.paused) {
            playMusic();
        }
    }, { once: true });
    
    // 4. 辅助：监听音频状态同步图标
    bgm.onplay = () => musicTrigger.classList.add('playing');
    bgm.onpause = () => musicTrigger.classList.remove('playing');

        // 加载留言
    async function loadComments() {
      try {
        const res = await fetch(`/api/comment?page=${PAGE}`);
        const comments = await res.json();
        
        if (!comments || comments.length === 0) {
          commentList.innerHTML = '<p style="text-align:center; color:#ccc; margin-top:20px;">暂无留言</p>';
          return;
        }
    
        // --- 排序算法开始 ---
        let thread = []; // 存储最终排序后的数组
        let mainComments = comments.filter(c => !c.content.trim().startsWith('@'));
        let replies = comments.filter(c => c.content.trim().startsWith('@'));
    
        mainComments.forEach(main => {
          thread.push(main); // 先放主留言
          // 寻找所有回复这条主留言的评论（通过检查内容里是否包含 @用户名）
          let relatedReplies = replies.filter(r => r.content.includes(`@${main.name}`));
          thread.push(...relatedReplies); // 把属于它的回复紧跟其后
        });
    
        // 处理那些可能没匹配上的孤儿回复（可选）
        replies.forEach(r => {
            if (!thread.includes(r)) thread.push(r);
        });
        // --- 排序算法结束 ---
    
        commentList.innerHTML = thread.map(c => {
          const isReply = c.content.trim().startsWith('@');
          const bgColor = colors[c.name.length % colors.length];
          const firstChar = c.name.charAt(0).toUpperCase();
          
          return `
            <div class="comment-item ${isReply ? 'reply-item' : ''}">
              <div class="comment-avatar" style="background: ${bgColor}">${firstChar}</div>
              <div class="comment-content">
                <div class="comment-header">
                  <span class="comment-name">${c.name} ${isReply ? '<small class="reply-tag">回复</small>' : ''}</span>
                  <span class="comment-time">${formatTime(c.created_at)}</span>
                </div>
                <div class="comment-body">${c.content}</div>
                <div class="comment-actions">
                  <button onclick="replyTo('${c.name}')">回复</button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      } catch (err) {
        console.error(err);
        commentList.innerHTML = '<p style="color:red;">加载失败</p>';
      }
    }

    // 回复快捷操作
    function replyTo(username) {
      const textarea = document.getElementById("content");
      textarea.value = `@${username} `;
      textarea.focus();
    }

    // 提交留言
    document.getElementById("comment-form").onsubmit = async (e) => {
      e.preventDefault();
      const nameInput = document.getElementById("name");
      const contentInput = document.getElementById("content");
      const btn = e.target.querySelector('button');

      btn.disabled = true;
      btn.innerText = '发送中...';

      try {
        await fetch('/api/comment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            page: PAGE, 
            name: nameInput.value, 
            content: contentInput.value 
          })
        });
        contentInput.value = '';
        await loadComments();
      } catch (err) {
        alert('发送失败，请稍后再试');
      } finally {
        btn.disabled = false;
        btn.innerText = '发布留言';
      }
    }

    // 初始加载
    loadComments();
  </script>

</body>
  
<footer>
  <a href="2024.html">← 2024</a> |
  <a href="index.html">返回首页</a> |
  
</footer>
  
</html>
